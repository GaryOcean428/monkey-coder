# Monkey Coder Development Rules & Standards

*Consistent with Agent OS Standards (@~/.agent-os/standards/), CLAUDE.md, and docs/roadmap.md*

## Core Quality & Standards Rules

### 1. Multi-Persona Validation System
Before providing any solution, engage appropriate specialist personas to validate different aspects:
- Security concerns ‚Üí Security Specialist review (critical for Phase 1.6 Authentication System Unification)
- Performance implications ‚Üí Performance Optimizer review
- Architecture decisions ‚Üí Technical Architect validation

### 2. Duplication Prevention Protocol
Always check for existing similar functionality before creating new solutions:
- Search thoroughly for existing implementations
- Prefer extension/composition over duplication
- Document reasons for replacements clearly

### 3. Thinking Process Documentation
Use structured thinking approaches:
- `{[thinking]}` tags for planning
- ```thinking code blocks for reasoning
- Blockquotes for shorter planning notes
- Clear problem ‚Üí analysis ‚Üí solution flow

### 4. Technical Standards & Architecture Compliance
Adhere to Monkey Coder's established patterns and Agent OS standards:
- **Project Architecture**: Yarn 4.9.2 workspace monorepo with TypeScript CLI, Python FastAPI core
- **Package Management**: Use yarn 4.9.2+, pnpm fallback before npm directly (enable corepack as required)
- **Python Management**: Use uv then poetry before pip directly for Python 3.8+ projects
- **MCP Integration**: Use MCPs like context7 to verify current LLM models, API specifications and parameters
- **Language Conventions**: Follow TypeScript strict typing, Python type hints, React functional patterns
- **Code Organization**: Maintain modular and maintainable structure consistent with packages/ layout
- **Error Handling**: Implement proper error handling and loading states
- **Documentation**: Keep code well-documented and consistent with specifications
- **File Management**: Use docs/ folder for documentation, cleanup unneeded .md files after one-time use
- **Git Workflow**: Review docs/roadmap.md and update before commits
- **Check documentation**: Always looks to files like railway-docs-links.md and railpack-docs-links.md for Railway deployment patterns and configurations. Always use railpack and railpack.json setup.

### 5. Version Requirements Enforcement
Maintain awareness of minimum version requirements per project specifications:
- **Node.js**: >=18.0.0 (22+ preferred)
- **Python**: >=3.8 (3.12+ preferred)
- **Yarn**: >=4.9.2
- **TypeScript**: Strict typing enabled
- Prioritize modern, well-supported versions
- Check compatibility before recommendations
- Warn about deprecated technologies

### 6. Build vs. Remove Philosophy
Default to building and completing features rather than removing unused code:
- Investigate thoroughly before suggesting removals
- Prioritize feature completion over cleanup (especially for Phase 1.6 completion)
- Understand project intent through documentation analysis

### 7. Environment-Aware Solutions
Consider different environments (dev, test, prod) and Railway deployment requirements:
- Solutions must work across contexts
- Follow Railway deployment patterns from CLAUDE.md
- Consider Phase 1.6 Authentication System requirements

## Communication & Process Rules

### 8. Clear Task Understanding
Before executing any task, ensure complete understanding by:
- Analyzing for ambiguities
- Asking clarifying questions when needed
- Confirming intent before proceeding
- Gathering relevant context from available sources

### 9. Systematic Investigation Protocol
When troubleshooting or analyzing issues:
- Classify the problem type (build, deploy, runtime, etc.)
- Investigate root causes systematically
- Follow established error pattern recognition
- Provide actionable solutions with clear steps

### 10. Documentation Standards
Always consider documentation impact:
- Update relevant docs when suggesting changes
- Maintain clear change records in docs/roadmap.md
- Provide migration guidance for breaking changes
- Use clear, professional communication
- Reference Agent OS standards (@~/.agent-os/standards/)

## Security & Safety Rules

### 11. Security-First Approach (Critical for Phase 1.6)
Always evaluate security implications, especially for Authentication System Unification:
- Validate input sanitization needs
- Consider authentication/authorization requirements (httpOnly cookies, JWT, session management)
- Never compromise security for convenience
- Review for potential vulnerabilities
- Follow security patterns from CLAUDE.md

### 12. Careful Change Management
Only suggest changes that are:
- Well-understood and related to the request
- Thoroughly analyzed for side effects
- Documented with clear reasoning
- Tested or verifiable when possible
- Aligned with current roadmap priorities

## User Experience & Development Rules

### 13. TypeScript & Modern Development Focus
When providing code solutions:
- Prioritize TypeScript with strict typing
- Use modern React patterns (functional components, hooks)
- Use yarn 4.9.2+ and above, pnpm fallback before npm directly (enable corepack as required)
- Use uv then poetry before pip directly for Python 3.8+ projects
- Follow established naming conventions from Agent OS standards
- Implement proper error handling and loading states

### 14. Responsive & Accessible Design
Ensure recommendations consider:
- Cross-device compatibility
- Accessibility standards (ARIA attributes)
- Performance optimization
- User experience across different contexts
### 15. Railway Deployment Standards
Follow the 8-step checklist for Railway projects to ensure proper configuration and deployment:
- Pull the latest code
- Open key configuration files
- Verify port usage and binding
- Check inter-service URLs
- CORS configuration review
- WebSocket sanity check
- Dockerfile validation (if used)
  - Use `docker buildx build --builder cloud-garyocean77-superagi .` to use docker build cloud
- Deploy and test loop
- Commit and push changes after verification

### 16. Project Planning Standards
- **Do not include artificial timeframes into plans** - Phases and tasks should be based on complexity and requirements, not arbitrary deadlines
- Align with current roadmap priorities (especially Phase 1.6 Authentication System Unification)
- Reference established patterns from Agent OS documentation

## Railway Config Quick-Check (variable and reference variable Cheat-Sheet)

Follow this 8-step checklist every time you push or deploy a Railway project.

---

### 1. Pull the latest code
```bash
git pull origin main
```

---

### 2. Open the three files that matter
- `railway.toml` or `railway.json`
- `Dockerfile` (if you use one)
- Your main entry file (`server.js`, `app.py`, etc.)

---

### 3. Find or add the port line
| Language / Framework | Snippet to look for / insert |
|----------------------|------------------------------|
| Node.js (Express)    | `app.listen(process.env.PORT || 3000, '0.0.0.0')` |
| Next.js              | `"start": "next start --hostname 0.0.0.0 --port $PORT"` |
| Python (Flask)       | `app.run(host='0.0.0.0', port=int(os.getenv('PORT', 5000)))` |
| Python (Uvicorn)     | `uvicorn main:app --host 0.0.0.0 --port $PORT` |

üîç **Checklist**
- [ ] Uses `process.env.PORT` / `$PORT` / `os.getenv("PORT")`
- [ ] Binds to `0.0.0.0` (or `::` for IPv6)
- [ ] **No hard-coded port** like `3000` or `5000` alone

---

### 4. Verify inter-service URLs
Replace any hard-coded hostnames or ports with Railway reference variables:

| Instead of ‚Ä¶                     | Use ‚Ä¶ |
|----------------------------------|-------|
| `http://localhost:4000`          | `http://${{api.RAILWAY_PRIVATE_DOMAIN}}:${{api.PORT}}` |
| `https://my-api.example.com`     | `https://${{api.RAILWAY_PUBLIC_DOMAIN}}` |

üîç **Checklist**
- [ ] All internal traffic uses `http://` + `railway.internal` names
- [ ] All public traffic uses `https://` + `RAILWAY_PUBLIC_DOMAIN`
- [ ] **No** plain `localhost`, `127.0.0.1`, or raw IP addresses

---

### 5. CORS quick-scan (backend)
Look for CORS middleware and ensure it contains:

```js
// Node.js / Express example
app.use(cors({
  origin: [process.env.FRONTEND_URL],   // or array of allowed origins
  credentials: true
}));
```

üîç **Checklist**
- [ ] Origin list includes the exact deployed frontend URL(s)
- [ ] `credentials: true` if you send cookies / auth headers
- [ ] **Not** `origin: "*"` in production

---

### 6. WebSocket sanity check
Client-side connection string must match protocol:

| Frontend origin | WebSocket URL |
|-----------------|---------------|
| `https://‚Ä¶`     | `wss://<backend>.up.railway.app/socket.io/` |
| `http://localhost` dev | `ws://localhost:<port>/socket.io/` |

üîç **Checklist**
- [ ] **Never** mix `https` page with `ws://` (blocked by browser)
- [ ] **Server-side** Socket.IO or WS library also has CORS/origin validation

---

### 7. Dockerfile (if used)
Dockerfile should expose the port and accept build-time args:

```dockerfile
ARG PORT
EXPOSE ${PORT}
CMD ["node", "server.js"]
```

üîç **Checklist**
- [ ] Uses `ARG PORT` if you need the port at build time
- [ ] `EXPOSE` matches `$PORT`
- [ ] Final `CMD` starts the app without hard-coding port

---

### 8. Deploy & test loop
```bash
railway up
```
After each deploy:

- Open the **Railway dashboard ‚Üí Service ‚Üí Logs**
- Confirm: `Listening on 0.0.0.0:<PORT>` (or `[::]:<PORT>`)
- Hit the public URL or internal endpoint and verify 200/101 responses
- Check browser console for CORS or WebSocket errors

---

**Done?** ‚úÖ Commit the fixed files and push.

## Critical File Protection Rules (Aligned with CLAUDE.md)

### 17. NEVER MODIFY PROTECTED FILES
The following files are STRICTLY PROTECTED and must NEVER be modified without explicit approval:
- `packages/core/monkey_coder/models.py` - Contains validated AI model configurations critical for system stability
- Any file containing model definitions, API keys, or core provider configurations

**Rationale**: These files contain carefully validated configurations that ensure API compatibility and system stability. Unauthorized modifications can break the entire platform.

**Prohibited Actions**:
- Adding new models or providers
- Modifying existing model names, parameters, or capabilities
- Changing provider configurations or API endpoints
- Updating model limits or pricing information

**If changes are required**: Consult project maintainers and get explicit written approval before making ANY modifications to protected files.

---

*These rules provide structured, thorough, and professional assistance while maintaining high standards for code quality, security, and user experience. They emphasize systematic thinking, thorough analysis, and consideration of multiple perspectives before providing solutions.*