{
  "$schema": "https://schema.railpack.com",
  "provider": "python",
  "packages": {
    "python": "3.12",
    "node": "20"
  },
  "build": {
    "commands": [
      "echo 'üêí Starting Monkey Coder build process...'",
      "pip install --no-cache-dir --upgrade pip setuptools wheel",
      "pip install --no-cache-dir -r requirements-deploy.txt",
      "cd packages/core && pip install --no-cache-dir -e .",
      "echo 'üì¶ Python dependencies installed successfully'",
      "corepack enable",
      "corepack prepare yarn@4.9.2 --activate",
      "echo 'üîß Yarn 4.9.2 configured'",
      "yarn install --immutable || yarn install",
      "echo 'üì¶ Node dependencies installed'",
      "echo 'üèóÔ∏è Building frontend with environment variables...'",
      "export NEXT_OUTPUT_EXPORT=true",
      "export NODE_ENV=production", 
      "export NEXTAUTH_URL=${NEXTAUTH_URL:-https://coder.fastmonkey.au}",
      "export NEXTAUTH_SECRET=${NEXTAUTH_SECRET:-development-secret-change-in-production}",
      "export NEXT_PUBLIC_API_URL=${NEXT_PUBLIC_API_URL:-https://coder.fastmonkey.au}",
      "export NEXT_PUBLIC_APP_URL=${NEXT_PUBLIC_APP_URL:-https://coder.fastmonkey.au}",
      "export DATABASE_URL=${DATABASE_URL:-}",
      "export NEXT_TELEMETRY_DISABLED=1",
      "yarn workspace @monkey-coder/web run export && echo '‚úÖ Frontend build completed successfully' || echo '‚ö†Ô∏è Frontend build failed, runtime fallback will be used'",
      "ls -la packages/web/out/ || echo '‚ö†Ô∏è No frontend output directory found'",
      "echo 'üöÄ Build process completed'"
    ]
  },
  "deploy": {
    "startCommand": "python run_server.py",
    "healthCheckPath": "/health",
    "healthCheckTimeout": 300
  }
}
