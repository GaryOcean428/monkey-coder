# ============================================================================
# RAILWAY PRODUCTION ENVIRONMENT VARIABLES
# ============================================================================
# This file documents all environment variables needed for production
# deployment on Railway. Copy and configure these in Railway Dashboard.
#
# Priority Order: CRITICAL → REQUIRED → RECOMMENDED → OPTIONAL
# ============================================================================

# ============================================================================
# CRITICAL SECRETS (Deployment will fail without these)
# ============================================================================

# Database Connection (automatically provided by Railway PostgreSQL plugin)
DATABASE_URL=postgresql://user:pass@host:port/dbname

# JWT Authentication (generate with: openssl rand -hex 32)
JWT_SECRET_KEY=your-super-secret-jwt-key-minimum-32-characters-here
NEXTAUTH_SECRET=your-nextauth-secret-minimum-32-characters-here

# AI Provider API Keys (at least one required for core functionality)
OPENAI_API_KEY=sk-your-openai-api-key-here
ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key-here

# ============================================================================
# REQUIRED FOR PRODUCTION FEATURES
# ============================================================================

# Redis for Session Persistence (recommended: Railway Redis plugin)
REDIS_URL=redis://default:password@host:port
SESSION_BACKEND=redis  # or "memory" for fallback
RATE_LIMIT_BACKEND=redis

# Email Service (Resend for production email delivery)
RESEND_API_KEY=re_your-resend-api-key-here
NOTIFICATION_EMAIL_FROM=noreply@fastmonkey.au
EMAIL_PROVIDER=resend
SMTP_ENABLED=true

# OAuth Providers (for social login)
# Google OAuth (https://console.cloud.google.com/apis/credentials)
GOOGLE_OAUTH_CLIENT_ID=your-google-client-id.apps.googleusercontent.com
GOOGLE_OAUTH_CLIENT_SECRET=your-google-client-secret
# GitHub OAuth (https://github.com/settings/developers)
GITHUB_OAUTH_CLIENT_ID=your-github-client-id
GITHUB_OAUTH_CLIENT_SECRET=your-github-client-secret
OAUTH_REDIRECT_BASE=https://coder.fastmonkey.au/api/v1/auth/oauth
OAUTH_STATE_SECRET=$(openssl rand -hex 32)

# Application URLs
NEXT_PUBLIC_APP_URL=https://coder.fastmonkey.au
NEXT_PUBLIC_API_URL=https://monkey-coder-backend-production.up.railway.app
PUBLIC_APP_URL=https://coder.fastmonkey.au

# ============================================================================
# RECOMMENDED FOR PRODUCTION
# ============================================================================

# Email Notification Recipients
ADMIN_NOTIFICATION_EMAILS=admin@fastmonkey.au,support@fastmonkey.au
ENQUIRY_NOTIFICATION_EMAILS=enquiries@fastmonkey.au
ROLLBACK_NOTIFICATION_EMAILS=ops@fastmonkey.au

# Error Tracking (Sentry)
SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
SENTRY_ENVIRONMENT=production

# Stripe Billing (if using payment features)
STRIPE_SECRET_KEY=sk_live_your-stripe-secret-key
STRIPE_WEBHOOK_SECRET=whsec_your-webhook-secret

# Additional AI Providers (optional)
GOOGLE_API_KEY=your-google-ai-api-key
GROQ_API_KEY=your-groq-api-key

# ============================================================================
# RAILWAY PLATFORM CONFIGURATION
# ============================================================================

# Environment
ENV=production
NODE_ENV=production
PYTHON_ENV=production

# Railway Service Discovery (auto-populated by Railway)
RAILWAY_ENVIRONMENT=production
RAILWAY_PUBLIC_DOMAIN=${RAILWAY_PUBLIC_DOMAIN}
RAILWAY_PRIVATE_DOMAIN=${RAILWAY_PRIVATE_DOMAIN}

# CORS & Security
CORS_ORIGINS=https://coder.fastmonkey.au,https://monkey-coder-backend-production.up.railway.app
TRUSTED_HOSTS=coder.fastmonkey.au,*.railway.app,*.railway.internal
ENABLE_SECURITY_HEADERS=true
ENABLE_CORS=true

# ============================================================================
# SERVICE-SPECIFIC CONFIGURATION
# ============================================================================

# Port Binding (Railway auto-injects $PORT)
# Do NOT set PORT manually - Railway provides it automatically
# PORT=${PORT}

# Health Check Configuration
HEALTH_CHECK_PATH=/api/health
ENABLE_HEALTH_CHECKS=true

# Feature Flags
ENABLE_CONTEXT_MANAGER=true
ENABLE_RESULT_CACHE=true
ENABLE_PRICING_MIDDLEWARE=true
SERVE_FRONTEND=true  # false if using separate frontend service

# Logging
LOG_LEVEL=info
NEXT_TELEMETRY_DISABLED=1

# ============================================================================
# OPTIONAL CONFIGURATION
# ============================================================================

# JWT Configuration
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=30
JWT_REFRESH_TOKEN_EXPIRE_DAYS=30

# Session Configuration
COOKIE_SECURE=true
COOKIE_HTTPONLY=true
COOKIE_SAMESITE=lax
COOKIE_MAX_AGE_DAYS=30
SESSION_TIMEOUT_MINUTES=1440  # 24 hours

# Rate Limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10

# MFA (if implemented)
MFA_ENABLED=false

# Debug Mode (NEVER enable in production)
DEBUG=false

# ============================================================================
# DEPLOYMENT NOTES
# ============================================================================
#
# 1. SECURITY CHECKLIST:
#    - All SECRET values must be unique random strings
#    - Never commit real secrets to git
#    - Rotate secrets every 60-90 days
#    - Use Railway's secret management features
#
# 2. REQUIRED RAILWAY PLUGINS:
#    - PostgreSQL (for DATABASE_URL)
#    - Redis (for REDIS_URL) - recommended
#
# 3. EXTERNAL SERVICE SETUP:
#    - Resend: Verify domain at https://resend.com/domains
#    - Google OAuth: Configure callback URLs in Google Cloud Console
#    - GitHub OAuth: Configure callback URLs in GitHub Settings
#    - Sentry: Create project at https://sentry.io
#
# 4. RAILWAY SERVICE CONFIGURATION:
#    - monkey-coder (frontend): Use railpack.json
#    - monkey-coder-backend (API): Use railpack-backend.json
#    - monkey-coder-ml (ML): Use railpack-ml.json
#    - Set RAILWAY_CONFIG_FILE for each service
#
# 5. HEALTH CHECK VALIDATION:
#    After deployment, verify:
#    - GET /api/health - Basic health
#    - GET /health/readiness - Dependency status
#    - GET /health/comprehensive - Full system status
#
# 6. VERIFICATION COMMANDS:
#    curl https://your-domain.railway.app/api/health
#    curl https://your-domain.railway.app/health/readiness
#
# 7. ROLLBACK PROCEDURE:
#    railway rollback --service <service-id>
#    OR use Railway Dashboard → Deployments → Rollback
#
# ============================================================================
# TROUBLESHOOTING
# ============================================================================
#
# Build fails with lockfile errors:
# - Ensure railpack configs use "yarn install --immutable"
# - Clear Railway build cache if needed
#
# Redis connection fails:
# - System falls back to in-memory sessions automatically
# - Check REDIS_URL format and connectivity
#
# OAuth not working:
# - Verify callback URLs match OAuth provider configuration
# - Check OAUTH_REDIRECT_BASE is correct
# - Ensure CLIENT_ID and CLIENT_SECRET are set
#
# Email not sending:
# - Verify RESEND_API_KEY is valid
# - Check domain is verified in Resend dashboard
# - Review logs for email service errors
#
# ============================================================================
